package book.jingdong;

import com.alibaba.fastjson.JSONObject;
import utils.Utils;
import utils.UtilsMini;

import java.util.HashSet;
import java.util.List;
import java.util.Set;

/**
 * @author ChenOT
 * @date 2020-03-17
 * @see
 * @since
 */
public class JingDongIsbn {
    public static void main(String[] args) {
        List<String> isbnNew = Utils.readFileToList("Q:\\tt.txt");
        String url = "https://way.jd.com/showapi/isbn?isbn=%s&appkey=7d07e35626c392c12cbee1a04186307a";
        String isbnNum = "9787548057437 |9787500085416 |9787115099778 |9787507223767 |9787539548890 |9787302473541 |9787545540925 |9787530757185 |9787221098061 |9787535855183 |9787550288638 |9787513560825 |9787568224857 |9787549625611 |9787556011186 |9787544250498 |9787558516887 |9787550278172 |9787544461856 |9787539457093 |9787122268747 |9787508690087 |9787540220969 |9787530579763 |9787559700872 |9787544850018 |9787538581812 |9787550220317 |9787508676036 |9787537660709 |9787811011920 |9787218126319 |9787302441090 |9787516515082 |9787506087285 |9787564533472 |9787539548913 |9787201119991 |9787502843571 |9787553312828 |9787515347318 |9787535059123 |9787508659077 |9787505621213 |9787115468895 |9787559607935 |9787519301972 |9787514208474 |9787556001569 |9787557515904 |9787558036910 |9787510152016 |9787544541428 |9787551504904 |9787510419805 |9787543480209 |9787551504843 |9787514846973 |9787553312828 |9787539183299 |9787510825750 |9787556806348 |9787513549615 |9787511272355 |9787531573012 |9787511039521 |9787559505576 |9787514209419 |9787221134387 |9787530754375 |9787510156038 |9787535851895 |9787556042609 |9787551527279 |9787539444512 |9787221078803 |9787519301972 |9787510834110 |9787221125378 |9787532480975 |9787513599436 |9787510133633 |9787532280513 |9787556001569 |9787539430744 |9787533165130 |9787304084141 |9787121167249 |9787544238342 |9787511024060 |9787514836738 |9787565815157 |9787539283739 |9787221132369 |9787501584277 |9787545538519 |9787557527419 |9787211073603 |9787551559553 |9787224116496 |9787511039330 |9787544826686 |9787530493465 |9787302412441 |9787513313025 |9787513541350 |9787511041753 |9787530497517 |9787550236608 |9787501604166 |9787499405561 |9787550278417 |9787558405228 |9787513574941 |9787531578758 |9787556804368 |9787535878632 |9787115346537 |9787221091857 |9787115243980 |9787558142833 |9787539548890 |9787530454237 |9787556228669 |9787534495694 |9787518325153 |9787535882349 |9787221110206 |9787545518603 |9787505634695 |9787510418990 |9787550220317 |9787514831481 |9787550211360 |9787546986586 |9787537664790 |9787504192851 |9787514812169 |9787040369342 |9787556825707 |9787532280483 |9787543677616 |9787510832895 |9787544808125 |9787550292024 |9787514829006 |9787510843020 |9787115460707 |9787549564019 |9787307117594 |9787550721715 |9787551574617 |9787121339554 |9787121055102 |9787533264338 |9787121187193 |9787530766491 |9787500791553 |9787545605402 |9787537651424 |9780192739858 |9787556064243 |9787500797005 |9787537147736 |9787544715706 |9787505622067 |9787510104091 |9787221112668 |9787550264762 |9787555207856 |9787543684041 |9787510868894 |9787505615472 |9787556001583 |9787544838696 |9787500096337 |9787533278182 |9787544470537 |9787541062544 |9787502070571 |9787115415028 |9787568836302 |9787533285432 |9787552544732 |9787539430799 |9787556007417 |9787536579545 |9787555706335 |9787500085430 |9787513309937 |9787514810356 |9787801768612 |9787545611656 |9787539198699 |9787531891581 |9787506086912 |9787557010546 |9787535369956 |9787550267886 |9787115431424 ";
        Set<String> setOld = new HashSet<>();
        Set<String> setNew= new HashSet<>();
        String[] bnOld = isbnNum.split("\\|");
        for (String s : bnOld) {
            setOld.add(s.trim());
        }
        for (String s : isbnNew) {
            setNew.add(s.trim());
        }
        //        String isbnData = "9787548057437|9787500085416";
        String[] isbns = isbnNum.split("\\|");
        for (String isbnT : setNew) {
            if(setOld.contains(isbnT)) continue;
            String isbn = isbnT.trim();
            String result="";
            try{
                String reqUrl = String.format(url, isbn);
                result = Utils.httpGet(reqUrl);
                JSONObject jsonObject = JSONObject.parseObject(result);
                JSONObject data = jsonObject.getJSONObject("result").getJSONObject("showapi_res_body").getJSONObject("data");
                IsbnData isbnData = JSONObject.parseObject(data.toJSONString(),IsbnData.class) ;
                UtilsMini.writeToTxt("Q:\\isbn.txt", isbn+"\t"+isbnData.getTitle()+"\t"+isbnData.getAuthor()+"\t"+isbnData.getPublisher()+"\t"+isbnData.getGist()+"\t"+isbnData.getImg());
            }catch (Exception e){
                e.printStackTrace();
                System.out.println(result);
                UtilsMini.writeToTxt("Q:\\isbn.txt", isbn);
            }
        }

    }
}
